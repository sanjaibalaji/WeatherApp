{"ast":null,"code":"function defaultDispose() {}\nexport class StrongCache {\n  constructor(max = Infinity, dispose = defaultDispose) {\n    this.max = max;\n    this.dispose = dispose;\n    this.map = new Map();\n    this.newest = null;\n    this.oldest = null;\n  }\n  has(key) {\n    return this.map.has(key);\n  }\n  get(key) {\n    const node = this.getNode(key);\n    return node && node.value;\n  }\n  get size() {\n    return this.map.size;\n  }\n  getNode(key) {\n    const node = this.map.get(key);\n    if (node && node !== this.newest) {\n      const {\n        older,\n        newer\n      } = node;\n      if (newer) {\n        newer.older = older;\n      }\n      if (older) {\n        older.newer = newer;\n      }\n      node.older = this.newest;\n      node.older.newer = node;\n      node.newer = null;\n      this.newest = node;\n      if (node === this.oldest) {\n        this.oldest = newer;\n      }\n    }\n    return node;\n  }\n  set(key, value) {\n    let node = this.getNode(key);\n    if (node) {\n      return node.value = value;\n    }\n    node = {\n      key,\n      value,\n      newer: null,\n      older: this.newest\n    };\n    if (this.newest) {\n      this.newest.newer = node;\n    }\n    this.newest = node;\n    this.oldest = this.oldest || node;\n    this.map.set(key, node);\n    return node.value;\n  }\n  clean() {\n    while (this.oldest && this.map.size > this.max) {\n      this.delete(this.oldest.key);\n    }\n  }\n  delete(key) {\n    const node = this.map.get(key);\n    if (node) {\n      if (node === this.newest) {\n        this.newest = node.older;\n      }\n      if (node === this.oldest) {\n        this.oldest = node.newer;\n      }\n      if (node.newer) {\n        node.newer.older = node.older;\n      }\n      if (node.older) {\n        node.older.newer = node.newer;\n      }\n      this.map.delete(key);\n      this.dispose(node.value, key);\n      return true;\n    }\n    return false;\n  }\n}","map":{"version":3,"names":["defaultDispose","StrongCache","constructor","max","Infinity","dispose","map","Map","newest","oldest","has","key","get","node","getNode","value","size","older","newer","set","clean","delete"],"sources":["../src/strong.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}